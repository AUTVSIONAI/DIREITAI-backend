const { createClient } = require('@supabase/supabase-js');
require('dotenv').config();

// Cliente admin para opera√ß√µes que precisam contornar RLS
const adminSupabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

async function checkBadgesTable() {
  try {
    console.log('üîç Verificando se a tabela badges existe...');
    
    // Tentar buscar dados da tabela badges
    const { data: badges, error: badgesError } = await adminSupabase
      .from('badges')
      .select('*')
      .limit(5);
    
    if (badgesError) {
      console.error('‚ùå Erro ao acessar tabela badges:', badgesError);
      console.log('üìù A tabela badges provavelmente n√£o existe.');
      
      // Verificar se a tabela user_achievements existe
      console.log('\nüîç Verificando tabela user_achievements...');
      const { data: userAchievements, error: userAchievementsError } = await adminSupabase
        .from('user_achievements')
        .select('*')
        .limit(5);
      
      if (userAchievementsError) {
        console.error('‚ùå Erro ao acessar tabela user_achievements:', userAchievementsError);
      } else {
        console.log('‚úÖ Tabela user_achievements existe e tem', userAchievements.length, 'registros');
        console.log('üìã Estrutura da tabela user_achievements:');
        if (userAchievements.length > 0) {
          console.log('Colunas:', Object.keys(userAchievements[0]));
        }
      }
    } else {
      console.log('‚úÖ Tabela badges existe e tem', badges.length, 'registros');
      console.log('üìã Dados da tabela badges:');
      badges.forEach((badge, index) => {
        console.log(`${index + 1}. Badge:`, badge);
      });
    }
    
    // Verificar tamb√©m a tabela achievements
    console.log('\nüîç Verificando tabela achievements...');
    const { data: achievements, error: achievementsError } = await adminSupabase
      .from('achievements')
      .select('*')
      .limit(5);
    
    if (achievementsError) {
      console.error('‚ùå Erro ao acessar tabela achievements:', achievementsError);
    } else {
      console.log('‚úÖ Tabela achievements existe e tem', achievements.length, 'registros');
      achievements.forEach((achievement, index) => {
        console.log(`${index + 1}. Achievement:`, {
          id: achievement.id,
          name: achievement.name,
          description: achievement.description,
          requirements: achievement.requirements
        });
      });
    }
    
  } catch (error) {
    console.error('‚ùå Erro geral:', error);
  }
}

checkBadgesTable();